import{d as x,q as $,k as F,c as k,s as J,b as n,o as u,_ as N,i as O,v as B,x as C,n as z,l as j,y as W,u as a,g as T,m as S,e as b,j as G,z as Y,A as D,w as M,f as q,t as E,B as X,C as Z}from"./index-CFOzxytp.js";import{c as A}from"./commonLib-B4LiHA7t.js";import{u as P}from"./useSection-iV6qCcO5.js";import{u as ee,D as te,a as oe,b as se,c as ce,_ as ne,d as re,C as ae,e as ie}from"./common.angle.right-DUIBZAhS.js";import{C as le}from"./Chapters-DPcPmzQe.js";import"./courses-BhXbSCSR.js";const de="/assets/images/common.home.white.svg",ue="2QOUHASJKNADHAUIDJANDADADOJNK29371QN",pe="GUIQNASDII29",me="documentUnlockPassword",he="BNUQP@KNSJ@IASNDI@*!&#^@QNWIQ*Q!NASU",ve="MMh/hekJh1bnpphdbl6ppPDBQxgSyck3aPYkg0alOxFNtTebqVjtIMOkThvKW71GhXUYbQ==",y={salt:ue,iv:pe,unlockPasswordCookieName:me,lockQuestion:he,unlockAnswer:ve},V={set(m,s,i){let r="";if(i){const o=new Date;o.setTime(o.getTime()+i*24*60*60*1e3),r="; expires="+o.toUTCString()}document.cookie=m+"="+encodeURIComponent(s)+r+"; path=/"},get(m){const s=document.cookie.match(new RegExp("(^| )"+m+"=([^;]+)"));return s?decodeURIComponent(s[2]):null},delete(m){this.set(m,"",-1)}};class U{constructor(s,i,r){if(this.password=s,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.salt=this.encoder.encode(i),this.iv=this.encoder.encode(r),this.iv.length!==12)throw new Error("IV는 12바이트 문자열이어야 합니다.")}async getKey(){const s=await crypto.subtle.importKey("raw",this.encoder.encode(this.password),{name:"PBKDF2"},!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:this.salt,iterations:1e5,hash:"SHA-256"},s,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async encrypt(s){const i=await this.getKey(),r=await crypto.subtle.encrypt({name:"AES-GCM",iv:this.iv},i,this.encoder.encode(s));return btoa(String.fromCharCode(...new Uint8Array(r)))}async decrypt(s){const i=await this.getKey(),r=Uint8Array.from(atob(s),c=>c.charCodeAt(0)),o=await crypto.subtle.decrypt({name:"AES-GCM",iv:this.iv},i,r);return this.decoder.decode(o)}}const fe={class:"wrapper"},_e={class:"input-group"},Ie=x({__name:"DocumentLock",setup(m){console.log(U);const s=$("inputRef"),i=()=>{var o;(o=s.value)==null||o.focus()},r=async()=>{var e;const o=((e=s.value)==null?void 0:e.value)||"",c=()=>{window.alert("패스워드를 다시 확인해주세요."),i()};if(!o||await new U(o,y.salt,y.iv).encrypt(y.lockQuestion)!==y.unlockAnswer)return c();V.set(y.unlockPasswordCookieName,o),window.location.reload()};return F(()=>{i()}),(o,c)=>(u(),k("form",{class:"document-lock",onSubmit:J(r,["prevent"])},[n("div",fe,[n("div",_e,[n("input",{type:"password",class:"form-control",placeholder:"🔒 문서 접근 패스워드를 입력해주세요.",minlength:"36",maxlength:"36",ref_key:"inputRef",ref:s},null,512),c[0]||(c[0]=n("button",{type:"submit",class:"btn btn-dark"},"제출",-1))])])],32))}}),ye=N(Ie,[["__scopeId","data-v-98cf289e"]]),ke={key:1,class:"video"},ge={class:"content"},be=x({__name:"SectionCore",props:{courseId:{},chapterId:{},sectionId:{},onDocumentLoaded:{type:Function}},setup(m){const s=O(),i=G(),r=P(),{data:o,loading:c,request:d}=ee(),t=m,e=B({title:"WAIT A MOMENT",desc:"WAIT A MOMENT",videoUrl:null,document:"<p>PLEASE WAIT A MOMENT</p>",presentation:!1,accessible:!1,created:"WAIT A MOMENT",updated:"WAIT A MOMENT",courseTitle:"WAIT",chapterTitle:"WAIT",sources:[],references:[]}),v=C(()=>r.getSection(t.courseId,t.chapterId,t.sectionId)),h=()=>{if(!e.sources.length)return;const I=new DOMParser().parseFromString(e.document,"text/html");Array.from(I.querySelectorAll("[data-bs-toggle='popover']")).forEach((l,_)=>{if(!e.sources[_]){console.error("본문 속 팝오버의 개수와 출처 배열의 개수가 다릅니다.");return}l.setAttribute("title","자료 출처"),l.setAttribute("data-bs-content",A.linkify(e.sources[_])),l.innerText=`[${_+1}]`}),e.document=I.body.innerHTML};return z(async()=>{const I=r.getCourse(t.courseId);if(I){const f=r.getChapter(t.courseId,t.chapterId);if(f){const l=v.value;if(l){const _=V.get(y.unlockPasswordCookieName),p=window.location.hostname==="localhost";if(e.title=l.title,e.desc=l.desc,e.videoUrl=l.videoUrl,e.sources=l.sources,e.references=l.references,e.presentation=l.presentation,e.accessible=l.locked?!!_:!0,e.created=l.created,e.updated=l.updated,e.courseTitle=I.title,e.chapterTitle=f.title,e.accessible){if(await d({url:`/assets/courses/${t.courseId}/${t.chapterId}/${t.sectionId}/document.html`,contentType:"text/html"}),l.locked&&_&&!p){const g=new U(_,y.salt,y.iv);o.value=await g.decrypt(o.value).catch(w=>(console.error(w),console.error("문서를 복호화 할 수 없습니다."),null))}e.document=A.linkify(o.value),h()}Y(()=>{t.onDocumentLoaded()}),s.updateSiteTitle(A.extractText(e.title))}}}}),j(()=>{s.updateSiteTitle()}),(I,f)=>(u(),k("div",{class:W(["section-core",{skeleton:a(c)}])},[a(i).query.mode==="presentation"&&!a(c)&&!e.accessible?(u(),T(te,{key:0,title:e.title,desc:e.desc,document:e.document,sources:e.sources,references:e.references,created:e.created,updated:e.updated},null,8,["title","desc","document","sources","references","created","updated"])):S("",!0),b(oe,{title:a(A).extractText(e.title),desc:e.desc,presentation:e.presentation,created:e.created,updated:e.updated,skeleton:a(c)},null,8,["title","desc","presentation","created","updated","skeleton"]),e.videoUrl?(u(),k("div",ke,[b(se,{url:e.videoUrl,skeleton:a(c)},null,8,["url","skeleton"])])):S("",!0),n("div",ge,[e.accessible?(u(),T(ce,{key:0,document:e.document,skeleton:a(c)},null,8,["document","skeleton"])):(u(),T(ye,{key:1}))])],2))}}),Se=N(be,[["__scopeId","data-v-30cb2c33"]]),we={class:"wrapper"},Ce={class:"title"},Te={class:"title"},Ae=x({__name:"SectionNavigation",props:{courseId:{},chapterId:{},sectionId:{}},setup(m){const s=m,i=P(),r=D(()=>{var e;const d=[];return(((e=i.getCourse(s.courseId))==null?void 0:e.chapters)||[]).forEach(v=>{v.sections.forEach(h=>{d.push({id:h.id,title:A.extractText(h.title),url:`/courses/${s.courseId}/${v.id}/${h.id}`})})}),d}),o=D(()=>{let d=null;const t=r.value;for(let e=0;e<t.length;e++)if(t[e].id===s.sectionId){d=t[e-1];break}return d}),c=D(()=>{let d=null;const t=r.value;for(let e=0;e<t.length;e++)if(t[e].id===s.sectionId){d=t[e+1];break}return d});return(d,t)=>{const e=q("router-link");return u(),k("div",{class:W(["section-navigation",{both:a(o)&&a(c)}])},[n("div",we,[a(o)?(u(),T(e,{key:0,to:a(o).url||"",class:"item prev",title:a(o).title},{default:M(()=>[t[0]||(t[0]=n("div",{class:"label"},[n("img",{src:ne,alt:"이전"}),n("span",null,"이전")],-1)),n("div",Ce,E(a(o).title),1)]),_:1},8,["to","title"])):S("",!0),a(c)?(u(),T(e,{key:1,to:a(c).url,class:"item next",title:a(c).title},{default:M(()=>[t[1]||(t[1]=n("div",{class:"label"},[n("img",{src:re,alt:"다음"}),n("span",null,"다음")],-1)),n("div",Te,E(a(c).title),1)]),_:1},8,["to","title"])):S("",!0)])],2)}}}),xe=N(Ae,[["__scopeId","data-v-086a2450"]]),Ne={class:"section"},De={class:"container"},$e={class:"wrapper"},Me={class:"main"},Ee={class:"core",ref:"coreRef"},Ue={key:0,class:"sources"},Pe={key:1,class:"references"},Re={class:"navigation"},Ke=x({__name:"Section",setup(m){const s=O(),i=X(),r=P(),o=G(),c=$("chaptersTopRef"),d=$("chaptersRef"),t=B({contentLoaded:!1}),e=C(()=>{var p;return(p=o.params.courseId)==null?void 0:p.toString()}),v=C(()=>{var p;return(p=o.params.chapterId)==null?void 0:p.toString()}),h=C(()=>{var p;return(p=o.params.sectionId)==null?void 0:p.toString()}),I=C(()=>r.getCourse(e.value)),f=C(()=>r.getSection(e.value,v.value,h.value)),l=p=>{var g,w;s.windowSize.width<=1399||(w=d.value)==null||w.scrollTo({top:p-d.value.offsetTop-(((g=c.value)==null?void 0:g.offsetHeight)||0),behavior:"smooth"})},_=()=>{t.contentLoaded=!0};return(p,g)=>{var R,K,L,H;const w=q("router-link");return u(),k("div",Ne,[n("div",De,[n("div",$e,[n("div",Me,[n("div",Ee,[(u(),T(Se,{courseId:e.value,chapterId:v.value,sectionId:h.value,key:h.value,onDocumentLoaded:_},null,8,["courseId","chapterId","sectionId"]))],512),(K=(R=f.value)==null?void 0:R.sources)!=null&&K.length?(u(),k("div",Ue,[b(ae,{sources:f.value.sources},null,8,["sources"])])):S("",!0),(H=(L=f.value)==null?void 0:L.references)!=null&&H.length?(u(),k("div",Pe,[b(ie,{references:f.value.references},null,8,["references"])])):S("",!0),n("div",Re,[b(xe,{courseId:e.value,chapterId:v.value,sectionId:h.value},null,8,["courseId","chapterId","sectionId"])])]),t.contentLoaded?(u(),k("div",{key:0,class:"chapters",ref_key:"chaptersRef",ref:d,style:Z({height:a(i).mainHeight})},[n("div",{class:"top",ref_key:"chaptersTopRef",ref:c},[b(w,{to:`/courses/${e.value}`,class:"btn"},{default:M(()=>{var Q;return[g[0]||(g[0]=n("img",{src:de},null,-1)),n("span",null,E((Q=I.value)==null?void 0:Q.title),1)]}),_:1},8,["to"])],512),b(le,{courseId:e.value,chapterId:v.value,sectionId:h.value,theme:"light",onScrollable:l},null,8,["courseId","chapterId","sectionId"])],4)):S("",!0)])])])}}}),Ge=N(Ke,[["__scopeId","data-v-baa0bdab"]]);export{Ge as default};
