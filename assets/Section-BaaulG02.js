import{d as N,h as P,p as F,q,s as b,m as G,k as j,c as _,v as B,u as r,g as C,l as v,e as h,b as n,i as z,n as J,x as K,y as D,z as Q,o as d,_ as R,A as E,w as L,f as V,t as M,B as X,C as O,D as Y}from"./index-D75dJzZx.js";import{c as T}from"./commonLib-B4LiHA7t.js";import{u as H}from"./useSection-Cr6Q5rLx.js";import{u as Z,D as ee,a as te,b as oe,c as se,_ as ce,d as re,C as ne,e as ae}from"./common.angle.right-BcDEcQ6N.js";import{C as le}from"./CryptoHelper-m6j8gmxG.js";import{C as ie}from"./Chapters-Yy68KACe.js";import"./courses-C8ddziIV.js";const ue="/assets/images/common.home.white.svg",de={key:1,class:"video"},pe={class:"content"},me=N({__name:"SectionCore",props:{courseId:{},chapterId:{},sectionId:{},onDocumentLoaded:{type:Function}},setup(y){const p=P(),I=F(),f=J(),i=z(),u=H(),{data:a,loading:s,request:o}=Z(),c=y,e=q({title:"WAIT A MOMENT",desc:"WAIT A MOMENT",videoUrl:null,document:"<p>PLEASE WAIT A MOMENT</p>",presentation:!1,accessible:!1,created:"WAIT A MOMENT",updated:"WAIT A MOMENT",courseTitle:"WAIT",chapterTitle:"WAIT",sources:[],references:[]}),w=b(()=>u.getSection(c.courseId,c.chapterId,c.sectionId)),g=()=>{if(!e.sources.length)return;const m=new DOMParser().parseFromString(e.document,"text/html");Array.from(m.querySelectorAll("[data-bs-toggle='popover']")).forEach((t,l)=>{if(!e.sources[l]){console.error("본문 속 팝오버의 개수와 출처 배열의 개수가 다릅니다.");return}t.setAttribute("title","자료 출처"),t.setAttribute("data-bs-content",T.linkify(e.sources[l])),t.innerText=`[${l+1}]`}),e.document=m.body.innerHTML};return G(async()=>{const m=u.getCourse(c.courseId);if(m){const k=u.getChapter(c.courseId,c.chapterId);if(k){const t=w.value;if(t){if(t.locked&&!I.admin)return f.replace(I.getLoginUrl(i));const l=K.get(D.unlockPasswordCookieName),S=window.location.hostname==="localhost";if(e.title=t.title,e.desc=t.desc,e.videoUrl=t.videoUrl,e.sources=t.sources,e.references=t.references,e.presentation=t.presentation,e.accessible=t.locked?!!l:!0,e.created=t.created,e.updated=t.updated,e.courseTitle=m.title,e.chapterTitle=k.title,e.accessible){if(await o({url:`/assets/courses/${c.courseId}/${c.chapterId}/${c.sectionId}/document.html?${Date.now()}`,contentType:"text/html"}),t.locked&&l&&!S){const $=new le(l,D.salt,D.iv);a.value=await $.decrypt(a.value).catch(A=>(console.error({err:A,message:"문서를 복호화 할 수 없습니다."}),null))}e.document=T.linkify(a.value),g()}Q(()=>{c.onDocumentLoaded()}),p.updateSiteTitle(T.extractText(e.title))}}}}),j(()=>{p.updateSiteTitle()}),(m,k)=>(d(),_("div",{class:B(["section-core",{skeleton:r(s)}])},[r(i).query.mode==="presentation"&&!r(s)&&e.accessible?(d(),C(ee,{key:0,title:e.title,desc:e.desc,document:e.document,sources:e.sources,references:e.references,created:e.created,updated:e.updated},null,8,["title","desc","document","sources","references","created","updated"])):v("",!0),h(te,{title:r(T).extractText(e.title),desc:e.desc,presentation:e.presentation,created:e.created,updated:e.updated,accessible:e.accessible,skeleton:r(s)},null,8,["title","desc","presentation","created","updated","accessible","skeleton"]),e.videoUrl?(d(),_("div",de,[h(oe,{url:e.videoUrl,skeleton:r(s)},null,8,["url","skeleton"])])):v("",!0),n("div",pe,[e.accessible?(d(),C(se,{key:0,document:e.document,skeleton:r(s)},null,8,["document","skeleton"])):v("",!0)])],2))}}),ve=R(me,[["__scopeId","data-v-c39a790d"]]),fe={class:"wrapper"},he={class:"title"},_e={class:"title"},Ie=N({__name:"SectionNavigation",props:{courseId:{},chapterId:{},sectionId:{}},setup(y){const p=y,I=H(),f=E(()=>{var o;const a=[];return(((o=I.getCourse(p.courseId))==null?void 0:o.chapters)||[]).forEach(c=>{c.sections.forEach(e=>{a.push({id:e.id,title:T.extractText(e.title),url:`/courses/${p.courseId}/${c.id}/${e.id}`})})}),a}),i=E(()=>{let a=null;const s=f.value;for(let o=0;o<s.length;o++)if(s[o].id===p.sectionId){a=s[o-1];break}return a}),u=E(()=>{let a=null;const s=f.value;for(let o=0;o<s.length;o++)if(s[o].id===p.sectionId){a=s[o+1];break}return a});return(a,s)=>{const o=V("router-link");return d(),_("div",{class:B(["section-navigation",{both:r(i)&&r(u)}])},[n("div",fe,[r(i)?(d(),C(o,{key:0,to:r(i).url||"",class:"item prev",title:r(i).title},{default:L(()=>[s[0]||(s[0]=n("div",{class:"label"},[n("img",{src:ce,alt:"이전"}),n("span",null,"이전")],-1)),n("div",he,M(r(i).title),1)]),_:1},8,["to","title"])):v("",!0),r(u)?(d(),C(o,{key:1,to:r(u).url,class:"item next",title:r(u).title},{default:L(()=>[s[1]||(s[1]=n("div",{class:"label"},[n("img",{src:re,alt:"다음"}),n("span",null,"다음")],-1)),n("div",_e,M(r(u).title),1)]),_:1},8,["to","title"])):v("",!0)])],2)}}}),ge=R(Ie,[["__scopeId","data-v-086a2450"]]),ke={class:"section"},Se={class:"container"},be={class:"wrapper"},Te={class:"main"},Ce={class:"core",ref:"coreRef"},ye={key:0,class:"sources"},$e={key:1,class:"references"},Ae={class:"navigation"},we=N({__name:"Section",setup(y){const p=P(),I=X(),f=H(),i=z(),u=O("chaptersTopRef"),a=O("chaptersRef"),s=q({contentLoaded:!1}),o=b(()=>{var t;return(t=i.params.courseId)==null?void 0:t.toString()}),c=b(()=>{var t;return(t=i.params.chapterId)==null?void 0:t.toString()}),e=b(()=>{var t;return(t=i.params.sectionId)==null?void 0:t.toString()}),w=b(()=>f.getCourse(o.value)),g=b(()=>f.getSection(o.value,c.value,e.value)),m=t=>{var l,S;p.windowSize.width<=1399||(S=a.value)==null||S.scrollTo({top:t-a.value.offsetTop-(((l=u.value)==null?void 0:l.offsetHeight)||0),behavior:"smooth"})},k=()=>{s.contentLoaded=!0};return(t,l)=>{var $,A,x,U;const S=V("router-link");return d(),_("div",ke,[n("div",Se,[n("div",be,[n("div",Te,[n("div",Ce,[(d(),C(ve,{courseId:o.value,chapterId:c.value,sectionId:e.value,key:e.value,onDocumentLoaded:k},null,8,["courseId","chapterId","sectionId"]))],512),(A=($=g.value)==null?void 0:$.sources)!=null&&A.length?(d(),_("div",ye,[h(ne,{sources:g.value.sources},null,8,["sources"])])):v("",!0),(U=(x=g.value)==null?void 0:x.references)!=null&&U.length?(d(),_("div",$e,[h(ae,{references:g.value.references},null,8,["references"])])):v("",!0),n("div",Ae,[h(ge,{courseId:o.value,chapterId:c.value,sectionId:e.value},null,8,["courseId","chapterId","sectionId"])])]),s.contentLoaded?(d(),_("div",{key:0,class:"chapters",ref_key:"chaptersRef",ref:a,style:Y({height:r(I).mainHeight})},[n("div",{class:"top",ref_key:"chaptersTopRef",ref:u},[h(S,{to:`/courses/${o.value}`,class:"btn"},{default:L(()=>{var W;return[l[0]||(l[0]=n("img",{src:ue},null,-1)),n("span",null,M((W=w.value)==null?void 0:W.title),1)]}),_:1},8,["to"])],512),h(ie,{courseId:o.value,chapterId:c.value,sectionId:e.value,theme:"light",onScrollable:m},null,8,["courseId","chapterId","sectionId"])],4)):v("",!0)])])])}}}),He=R(we,[["__scopeId","data-v-7c28ff8f"]]);export{He as default};
