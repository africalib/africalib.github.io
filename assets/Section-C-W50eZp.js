import{d as x,q as $,k as F,c as y,s as J,b as n,o as u,_ as N,i as O,v as B,x as w,n as z,l as j,y as W,u as i,g as b,m as S,e as g,j as G,z as Y,A as D,w as M,f as q,t as E,B as X,C as Z}from"./index-BUefVK3C.js";import{c as T}from"./commonLib-B4LiHA7t.js";import{u as R}from"./useSection-iV6qCcO5.js";import{u as ee,D as te,a as oe,b as se,c as ne,_ as ce,d as re,C as ae,e as ie}from"./common.angle.right-EtmMRf-5.js";import{C as le}from"./Chapters-CI_9bXpN.js";import"./courses-BhXbSCSR.js";const de="/assets/images/common.home.white.svg",ue="2QOUHASJKNADHAUIDJANDADADOJNK29371QN",pe="GUIQNASDII29",me="documentUnlockPassword",he="BNUQP@KNSJ@IASNDI@*!&#^@QNWIQ*Q!NASU",ve="MMh/hekJh1bnpphdbl6ppPDBQxgSyck3aPYkg0alOxFNtTebqVjtIMOkThvKW71GhXUYbQ==",I={salt:ue,iv:pe,unlockPasswordCookieName:me,lockQuestion:he,unlockAnswer:ve},V={set(m,o,l){let c="";if(l){const s=new Date;s.setTime(s.getTime()+l*24*60*60*1e3),c="; expires="+s.toUTCString()}document.cookie=m+"="+encodeURIComponent(o)+c+"; path=/"},get(m){const o=document.cookie.match(new RegExp("(^| )"+m+"=([^;]+)"));return o?decodeURIComponent(o[2]):null},delete(m){this.set(m,"",-1)}};class U{constructor(o,l,c){if(this.password=o,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.salt=this.encoder.encode(l),this.iv=this.encoder.encode(c),this.iv.length!==12)throw new Error("IV는 12바이트 문자열이어야 합니다.")}async getKey(){const o=await crypto.subtle.importKey("raw",this.encoder.encode(this.password),{name:"PBKDF2"},!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:this.salt,iterations:1e5,hash:"SHA-256"},o,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async encrypt(o){const l=await this.getKey(),c=await crypto.subtle.encrypt({name:"AES-GCM",iv:this.iv},l,this.encoder.encode(o));return btoa(String.fromCharCode(...new Uint8Array(c)))}async decrypt(o){const l=await this.getKey(),c=Uint8Array.from(atob(o),r=>r.charCodeAt(0)),s=await crypto.subtle.decrypt({name:"AES-GCM",iv:this.iv},l,c);return this.decoder.decode(s)}}const fe={class:"wrapper"},_e={class:"input-group"},ke=x({__name:"DocumentLock",setup(m){console.log(U);const o=$("inputRef"),l=()=>{var s;(s=o.value)==null||s.focus()},c=async()=>{var t;const s=((t=o.value)==null?void 0:t.value)||"",a=await new U(s,I.salt,I.iv).encrypt(I.lockQuestion);if(a!==I.unlockAnswer)return window.alert("올바른 패스워드가 아닙니다. 다시 입력해주세요."),l();V.set(I.unlockPasswordCookieName,a),window.location.reload()};return F(()=>{l()}),(s,r)=>(u(),y("form",{class:"document-lock",onSubmit:J(c,["prevent"])},[n("div",fe,[n("div",_e,[n("input",{type:"password",class:"form-control",placeholder:"🔒 문서 접근 패스워드를 입력해주세요.",minlength:"36",maxlength:"36",ref_key:"inputRef",ref:o},null,512),r[0]||(r[0]=n("button",{type:"submit",class:"btn btn-dark"},"제출",-1))])])],32))}}),Ie=N(ke,[["__scopeId","data-v-7a2d91c7"]]),ye={key:1,class:"video"},ge={class:"content"},Se=x({__name:"SectionCore",props:{courseId:{},chapterId:{},sectionId:{},onDocumentLoaded:{type:Function}},setup(m){const o=O(),l=G(),c=R(),{data:s,loading:r,request:a}=ee(),t=m,e=B({title:"WAIT A MOMENT",desc:"WAIT A MOMENT",videoUrl:null,document:"<p>PLEASE WAIT A MOMENT</p>",presentation:!1,locked:!1,created:"WAIT A MOMENT",updated:"WAIT A MOMENT",courseTitle:"WAIT",chapterTitle:"WAIT",sources:[],references:[]}),v=w(()=>c.getSection(t.courseId,t.chapterId,t.sectionId)),h=()=>{if(!e.sources.length)return;const _=new DOMParser().parseFromString(e.document,"text/html");Array.from(_.querySelectorAll("[data-bs-toggle='popover']")).forEach((d,k)=>{if(!e.sources[k]){console.error("본문 속 팝오버의 개수와 출처 배열의 개수가 다릅니다.");return}d.setAttribute("title","자료 출처"),d.setAttribute("data-bs-content",T.linkify(e.sources[k])),d.innerText=`[${k+1}]`}),e.document=_.body.innerHTML};return z(async()=>{const _=c.getCourse(t.courseId);if(_){const f=c.getChapter(t.courseId,t.chapterId);if(f){const d=v.value;if(d){const k=V.get(I.unlockPasswordCookieName);if(e.title=d.title,e.desc=d.desc,e.videoUrl=d.videoUrl,e.sources=d.sources,e.references=d.references,e.presentation=d.presentation,e.locked=d.locked?!k:!1,e.created=d.created,e.updated=d.updated,e.courseTitle=_.title,e.chapterTitle=f.title,!e.locked){if(await a({url:`/assets/courses/${t.courseId}/${t.chapterId}/${t.sectionId}/document.html`,contentType:"text/html"}),window.location.hostname!=="localhost"){const p=new U(k,I.salt,I.iv);s.value=p.decrypt(s.value)}e.document=T.linkify(s.value),h()}Y(()=>{t.onDocumentLoaded()}),o.updateSiteTitle(T.extractText(e.title))}}}}),j(()=>{o.updateSiteTitle()}),(_,f)=>(u(),y("div",{class:W(["section-core",{skeleton:i(r)}])},[i(l).query.mode==="presentation"&&!i(r)&&!e.locked?(u(),b(te,{key:0,title:e.title,desc:e.desc,document:e.document,sources:e.sources,references:e.references,created:e.created,updated:e.updated},null,8,["title","desc","document","sources","references","created","updated"])):S("",!0),g(oe,{title:i(T).extractText(e.title),desc:e.desc,presentation:e.presentation,created:e.created,updated:e.updated,skeleton:i(r)},null,8,["title","desc","presentation","created","updated","skeleton"]),e.videoUrl?(u(),y("div",ye,[g(se,{url:e.videoUrl,skeleton:i(r)},null,8,["url","skeleton"])])):S("",!0),n("div",ge,[e.locked?(u(),b(Ie,{key:0})):(u(),b(ne,{key:1,document:e.document,skeleton:i(r)},null,8,["document","skeleton"]))])],2))}}),we=N(Se,[["__scopeId","data-v-cba984f7"]]),be={class:"wrapper"},Ce={class:"title"},Te={class:"title"},Ae=x({__name:"SectionNavigation",props:{courseId:{},chapterId:{},sectionId:{}},setup(m){const o=m,l=R(),c=D(()=>{var e;const a=[];return(((e=l.getCourse(o.courseId))==null?void 0:e.chapters)||[]).forEach(v=>{v.sections.forEach(h=>{a.push({id:h.id,title:T.extractText(h.title),url:`/courses/${o.courseId}/${v.id}/${h.id}`})})}),a}),s=D(()=>{let a=null;const t=c.value;for(let e=0;e<t.length;e++)if(t[e].id===o.sectionId){a=t[e-1];break}return a}),r=D(()=>{let a=null;const t=c.value;for(let e=0;e<t.length;e++)if(t[e].id===o.sectionId){a=t[e+1];break}return a});return(a,t)=>{const e=q("router-link");return u(),y("div",{class:W(["section-navigation",{both:i(s)&&i(r)}])},[n("div",be,[i(s)?(u(),b(e,{key:0,to:i(s).url||"",class:"item prev",title:i(s).title},{default:M(()=>[t[0]||(t[0]=n("div",{class:"label"},[n("img",{src:ce,alt:"이전"}),n("span",null,"이전")],-1)),n("div",Ce,E(i(s).title),1)]),_:1},8,["to","title"])):S("",!0),i(r)?(u(),b(e,{key:1,to:i(r).url,class:"item next",title:i(r).title},{default:M(()=>[t[1]||(t[1]=n("div",{class:"label"},[n("img",{src:re,alt:"다음"}),n("span",null,"다음")],-1)),n("div",Te,E(i(r).title),1)]),_:1},8,["to","title"])):S("",!0)])],2)}}}),xe=N(Ae,[["__scopeId","data-v-086a2450"]]),Ne={class:"section"},De={class:"container"},$e={class:"wrapper"},Me={class:"main"},Ee={class:"core",ref:"coreRef"},Ue={key:0,class:"sources"},Re={key:1,class:"references"},Pe={class:"navigation"},Ke=x({__name:"Section",setup(m){const o=O(),l=X(),c=R(),s=G(),r=$("chaptersTopRef"),a=$("chaptersRef"),t=B({contentLoaded:!1}),e=w(()=>{var p;return(p=s.params.courseId)==null?void 0:p.toString()}),v=w(()=>{var p;return(p=s.params.chapterId)==null?void 0:p.toString()}),h=w(()=>{var p;return(p=s.params.sectionId)==null?void 0:p.toString()}),_=w(()=>c.getCourse(e.value)),f=w(()=>c.getSection(e.value,v.value,h.value)),d=p=>{var C,A;o.windowSize.width<=1399||(A=a.value)==null||A.scrollTo({top:p-a.value.offsetTop-(((C=r.value)==null?void 0:C.offsetHeight)||0),behavior:"smooth"})},k=()=>{t.contentLoaded=!0};return(p,C)=>{var P,K,L,H;const A=q("router-link");return u(),y("div",Ne,[n("div",De,[n("div",$e,[n("div",Me,[n("div",Ee,[(u(),b(we,{courseId:e.value,chapterId:v.value,sectionId:h.value,key:h.value,onDocumentLoaded:k},null,8,["courseId","chapterId","sectionId"]))],512),(K=(P=f.value)==null?void 0:P.sources)!=null&&K.length?(u(),y("div",Ue,[g(ae,{sources:f.value.sources},null,8,["sources"])])):S("",!0),(H=(L=f.value)==null?void 0:L.references)!=null&&H.length?(u(),y("div",Re,[g(ie,{references:f.value.references},null,8,["references"])])):S("",!0),n("div",Pe,[g(xe,{courseId:e.value,chapterId:v.value,sectionId:h.value},null,8,["courseId","chapterId","sectionId"])])]),t.contentLoaded?(u(),y("div",{key:0,class:"chapters",ref_key:"chaptersRef",ref:a,style:Z({height:i(l).mainHeight})},[n("div",{class:"top",ref_key:"chaptersTopRef",ref:r},[g(A,{to:`/courses/${e.value}`,class:"btn"},{default:M(()=>{var Q;return[C[0]||(C[0]=n("img",{src:de},null,-1)),n("span",null,E((Q=_.value)==null?void 0:Q.title),1)]}),_:1},8,["to"])],512),g(le,{courseId:e.value,chapterId:v.value,sectionId:h.value,theme:"light",onScrollable:d},null,8,["courseId","chapterId","sectionId"])],4)):S("",!0)])])])}}}),Ge=N(Ke,[["__scopeId","data-v-baa0bdab"]]);export{Ge as default};
