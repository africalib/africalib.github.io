import{d as x,q as $,k as F,c as k,s as J,b as c,o as p,_ as N,i as O,v as B,x as w,n as z,l as j,y as W,u as i,g as C,m as S,e as b,j as G,z as Y,A as D,w as M,f as q,t as E,B as X,C as Z}from"./index-BOOPI5MM.js";import{c as T}from"./commonLib-B4LiHA7t.js";import{u as R}from"./useSection-iV6qCcO5.js";import{u as ee,D as te,a as oe,b as se,c as ce,_ as ne,d as re,C as ae,e as ie}from"./common.angle.right-BNdXTfEU.js";import{C as le}from"./Chapters-Br6wLXgC.js";import"./courses-BhXbSCSR.js";const de="/assets/images/common.home.white.svg",ue="2QOUHASJKNADHAUIDJANDADADOJNK29371QN",pe="GUIQNASDII29",me="documentUnlockPassword",he="BNUQP@KNSJ@IASNDI@*!&#^@QNWIQ*Q!NASU",ve="MMh/hekJh1bnpphdbl6ppPDBQxgSyck3aPYkg0alOxFNtTebqVjtIMOkThvKW71GhXUYbQ==",y={salt:ue,iv:pe,unlockPasswordCookieName:me,lockQuestion:he,unlockAnswer:ve},V={set(m,o,l){let n="";if(l){const s=new Date;s.setTime(s.getTime()+l*24*60*60*1e3),n="; expires="+s.toUTCString()}document.cookie=m+"="+encodeURIComponent(o)+n+"; path=/"},get(m){const o=document.cookie.match(new RegExp("(^| )"+m+"=([^;]+)"));return o?decodeURIComponent(o[2]):null},delete(m){this.set(m,"",-1)}};class U{constructor(o,l,n){if(this.password=o,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.salt=this.encoder.encode(l),this.iv=this.encoder.encode(n),this.iv.length!==12)throw new Error("IV는 12바이트 문자열이어야 합니다.")}async getKey(){const o=await crypto.subtle.importKey("raw",this.encoder.encode(this.password),{name:"PBKDF2"},!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:this.salt,iterations:1e5,hash:"SHA-256"},o,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async encrypt(o){const l=await this.getKey(),n=await crypto.subtle.encrypt({name:"AES-GCM",iv:this.iv},l,this.encoder.encode(o));return btoa(String.fromCharCode(...new Uint8Array(n)))}async decrypt(o){const l=await this.getKey(),n=Uint8Array.from(atob(o),r=>r.charCodeAt(0)),s=await crypto.subtle.decrypt({name:"AES-GCM",iv:this.iv},l,n);return this.decoder.decode(s)}}const fe={class:"wrapper"},_e={class:"input-group"},Ie=x({__name:"DocumentLock",setup(m){console.log(U);const o=$("inputRef"),l=()=>{var s;(s=o.value)==null||s.focus()},n=async()=>{var t;const s=((t=o.value)==null?void 0:t.value)||"",a=await new U(s,y.salt,y.iv).encrypt(y.lockQuestion);if(a!==y.unlockAnswer)return window.alert("올바른 패스워드가 아닙니다. 다시 입력해주세요."),l();V.set(y.unlockPasswordCookieName,a),window.location.reload()};return F(()=>{l()}),(s,r)=>(p(),k("form",{class:"document-lock",onSubmit:J(n,["prevent"])},[c("div",fe,[c("div",_e,[c("input",{type:"password",class:"form-control",placeholder:"🔒 문서 접근 패스워드를 입력해주세요.",minlength:"36",maxlength:"36",ref_key:"inputRef",ref:o},null,512),r[0]||(r[0]=c("button",{type:"submit",class:"btn btn-dark"},"제출",-1))])])],32))}}),ye=N(Ie,[["__scopeId","data-v-7a2d91c7"]]),ke={key:1,class:"video"},ge={class:"content"},be=x({__name:"SectionCore",props:{courseId:{},chapterId:{},sectionId:{},onDocumentLoaded:{type:Function}},setup(m){const o=O(),l=G(),n=R(),{data:s,loading:r,request:a}=ee(),t=m,e=B({title:"WAIT A MOMENT",desc:"WAIT A MOMENT",videoUrl:null,document:"<p>PLEASE WAIT A MOMENT</p>",presentation:!1,accessible:!1,created:"WAIT A MOMENT",updated:"WAIT A MOMENT",courseTitle:"WAIT",chapterTitle:"WAIT",sources:[],references:[]}),v=w(()=>n.getSection(t.courseId,t.chapterId,t.sectionId)),h=()=>{if(!e.sources.length)return;const I=new DOMParser().parseFromString(e.document,"text/html");Array.from(I.querySelectorAll("[data-bs-toggle='popover']")).forEach((d,_)=>{if(!e.sources[_]){console.error("본문 속 팝오버의 개수와 출처 배열의 개수가 다릅니다.");return}d.setAttribute("title","자료 출처"),d.setAttribute("data-bs-content",T.linkify(e.sources[_])),d.innerText=`[${_+1}]`}),e.document=I.body.innerHTML};return z(async()=>{const I=n.getCourse(t.courseId);if(I){const f=n.getChapter(t.courseId,t.chapterId);if(f){const d=v.value;if(d){const _=V.get(y.unlockPasswordCookieName),u=window.location.hostname==="localhost";if(e.title=d.title,e.desc=d.desc,e.videoUrl=d.videoUrl,e.sources=d.sources,e.references=d.references,e.presentation=d.presentation,e.accessible=u?!0:d.locked?!!_:!0,e.created=d.created,e.updated=d.updated,e.courseTitle=I.title,e.chapterTitle=f.title,e.accessible){if(await a({url:`/assets/courses/${t.courseId}/${t.chapterId}/${t.sectionId}/document.html`,contentType:"text/html"}),d.locked&&_&&!u){const g=new U(_,y.salt,y.iv);s.value=await g.decrypt(s.value)}e.document=T.linkify(s.value),h()}Y(()=>{t.onDocumentLoaded()}),o.updateSiteTitle(T.extractText(e.title))}}}}),j(()=>{o.updateSiteTitle()}),(I,f)=>(p(),k("div",{class:W(["section-core",{skeleton:i(r)}])},[i(l).query.mode==="presentation"&&!i(r)&&!e.accessible?(p(),C(te,{key:0,title:e.title,desc:e.desc,document:e.document,sources:e.sources,references:e.references,created:e.created,updated:e.updated},null,8,["title","desc","document","sources","references","created","updated"])):S("",!0),b(oe,{title:i(T).extractText(e.title),desc:e.desc,presentation:e.presentation,created:e.created,updated:e.updated,skeleton:i(r)},null,8,["title","desc","presentation","created","updated","skeleton"]),e.videoUrl?(p(),k("div",ke,[b(se,{url:e.videoUrl,skeleton:i(r)},null,8,["url","skeleton"])])):S("",!0),c("div",ge,[e.accessible?(p(),C(ce,{key:0,document:e.document,skeleton:i(r)},null,8,["document","skeleton"])):(p(),C(ye,{key:1}))])],2))}}),Se=N(be,[["__scopeId","data-v-3a3bc3c4"]]),we={class:"wrapper"},Ce={class:"title"},Te={class:"title"},Ae=x({__name:"SectionNavigation",props:{courseId:{},chapterId:{},sectionId:{}},setup(m){const o=m,l=R(),n=D(()=>{var e;const a=[];return(((e=l.getCourse(o.courseId))==null?void 0:e.chapters)||[]).forEach(v=>{v.sections.forEach(h=>{a.push({id:h.id,title:T.extractText(h.title),url:`/courses/${o.courseId}/${v.id}/${h.id}`})})}),a}),s=D(()=>{let a=null;const t=n.value;for(let e=0;e<t.length;e++)if(t[e].id===o.sectionId){a=t[e-1];break}return a}),r=D(()=>{let a=null;const t=n.value;for(let e=0;e<t.length;e++)if(t[e].id===o.sectionId){a=t[e+1];break}return a});return(a,t)=>{const e=q("router-link");return p(),k("div",{class:W(["section-navigation",{both:i(s)&&i(r)}])},[c("div",we,[i(s)?(p(),C(e,{key:0,to:i(s).url||"",class:"item prev",title:i(s).title},{default:M(()=>[t[0]||(t[0]=c("div",{class:"label"},[c("img",{src:ne,alt:"이전"}),c("span",null,"이전")],-1)),c("div",Ce,E(i(s).title),1)]),_:1},8,["to","title"])):S("",!0),i(r)?(p(),C(e,{key:1,to:i(r).url,class:"item next",title:i(r).title},{default:M(()=>[t[1]||(t[1]=c("div",{class:"label"},[c("img",{src:re,alt:"다음"}),c("span",null,"다음")],-1)),c("div",Te,E(i(r).title),1)]),_:1},8,["to","title"])):S("",!0)])],2)}}}),xe=N(Ae,[["__scopeId","data-v-086a2450"]]),Ne={class:"section"},De={class:"container"},$e={class:"wrapper"},Me={class:"main"},Ee={class:"core",ref:"coreRef"},Ue={key:0,class:"sources"},Re={key:1,class:"references"},Pe={class:"navigation"},Ke=x({__name:"Section",setup(m){const o=O(),l=X(),n=R(),s=G(),r=$("chaptersTopRef"),a=$("chaptersRef"),t=B({contentLoaded:!1}),e=w(()=>{var u;return(u=s.params.courseId)==null?void 0:u.toString()}),v=w(()=>{var u;return(u=s.params.chapterId)==null?void 0:u.toString()}),h=w(()=>{var u;return(u=s.params.sectionId)==null?void 0:u.toString()}),I=w(()=>n.getCourse(e.value)),f=w(()=>n.getSection(e.value,v.value,h.value)),d=u=>{var g,A;o.windowSize.width<=1399||(A=a.value)==null||A.scrollTo({top:u-a.value.offsetTop-(((g=r.value)==null?void 0:g.offsetHeight)||0),behavior:"smooth"})},_=()=>{t.contentLoaded=!0};return(u,g)=>{var P,K,L,H;const A=q("router-link");return p(),k("div",Ne,[c("div",De,[c("div",$e,[c("div",Me,[c("div",Ee,[(p(),C(Se,{courseId:e.value,chapterId:v.value,sectionId:h.value,key:h.value,onDocumentLoaded:_},null,8,["courseId","chapterId","sectionId"]))],512),(K=(P=f.value)==null?void 0:P.sources)!=null&&K.length?(p(),k("div",Ue,[b(ae,{sources:f.value.sources},null,8,["sources"])])):S("",!0),(H=(L=f.value)==null?void 0:L.references)!=null&&H.length?(p(),k("div",Re,[b(ie,{references:f.value.references},null,8,["references"])])):S("",!0),c("div",Pe,[b(xe,{courseId:e.value,chapterId:v.value,sectionId:h.value},null,8,["courseId","chapterId","sectionId"])])]),t.contentLoaded?(p(),k("div",{key:0,class:"chapters",ref_key:"chaptersRef",ref:a,style:Z({height:i(l).mainHeight})},[c("div",{class:"top",ref_key:"chaptersTopRef",ref:r},[b(A,{to:`/courses/${e.value}`,class:"btn"},{default:M(()=>{var Q;return[g[0]||(g[0]=c("img",{src:de},null,-1)),c("span",null,E((Q=I.value)==null?void 0:Q.title),1)]}),_:1},8,["to"])],512),b(le,{courseId:e.value,chapterId:v.value,sectionId:h.value,theme:"light",onScrollable:d},null,8,["courseId","chapterId","sectionId"])],4)):S("",!0)])])])}}}),Ge=N(Ke,[["__scopeId","data-v-baa0bdab"]]);export{Ge as default};
