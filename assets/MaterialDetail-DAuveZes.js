import{d as M,c as i,e as t,F as C,r as O,t as A,g as _,o as r,_ as E,n as V,h as X,b,u as q,i as Y,j as I,f as k,k as x,T as ae,l as Q,m as P,p as oe,q as H,s as W,v as ne,w as re,x as le,y as N,z as ce,A as j,B as D,C as Z,D as ie,E as F}from"./index-CAQMgjy9.js";import{u as U,M as K}from"./Materials-C0z9m2Oa.js";import{T as ue}from"./Tags-ClVIhv33.js";import{c as S}from"./commonLib-B4LiHA7t.js";import{C as de}from"./CryptoHelper-m6j8gmxG.js";import{_ as me,a as pe,b as _e}from"./common.arrow.left-TSorRx6s.js";import{r as ve}from"./routeLib-DhAZaWiT.js";import{A as fe}from"./Above-BE_fwMW8.js";import"./Panel-zjS9hdjJ.js";const he={class:"common-sources"},ge={class:"items"},ye={class:"item"},ke=["innerHTML"],be=M({__name:"MaterialSources",props:{sources:{}},setup(v){const e=v;return(c,u)=>(r(),i("div",he,[u[0]||(u[0]=t("div",{class:"subject"},"자료 출처",-1)),t("div",ge,[(r(!0),i(C,null,O(e.sources,(g,y)=>(r(),i("div",ye,[t("span",null,"["+A(y+1)+"] ",1),t("span",{innerHTML:_(S).linkify(g)},null,8,ke)]))),256))])]))}}),ee=E(be,[["__scopeId","data-v-3b532ca9"]]),$e={class:"common-references"},xe={class:"items"},Se={class:"item"},Te=M({__name:"MaterialReferences",props:{references:{}},setup(v){const e=v;return(c,u)=>(r(),i("div",$e,[u[0]||(u[0]=t("div",{class:"subject"},"참고 자료",-1)),t("div",xe,[(r(!0),i(C,null,O(e.references,g=>(r(),i("div",Se,[t("span",null,A(g),1)]))),256))])]))}}),te=E(Te,[["__scopeId","data-v-9a0696c5"]]),Me=["innerHTML"],we=M({__name:"DocumentContent",props:{document:{},skeleton:{type:Boolean}},setup(v){const e=v;return(c,u)=>(r(),i("div",{class:V(["document-content",{skeleton:e.skeleton}])},[t("div",{innerHTML:e.document,ref:"contentRef"},null,8,Me)],2))}}),se=E(we,[["__scopeId","data-v-8b5f5b06"]]),Le="/assets/images/component.document.presentation.slide.first.svg",Ee="/assets/images/component.material.presentation.finish.svg",B=M({__name:"DocumentPrompt",props:{content:{}},setup(v){const e=v;return X(()=>{console.info(e.content.replace(/\n{3,}/g,`

`))}),(c,u)=>null}}),Ae={class:"presentation"},Ce={class:"slides"},Re={key:0,class:"slide start"},Ie={class:"container"},De={class:"slide-item"},qe=["innerHTML"],He={key:1,class:"slide finish"},Pe={class:"container"},Ne={key:0,class:"slide"},je={class:"container"},G="no-overflow",Fe=M({__name:"MaterialPresentation",props:{material:{},document:{}},setup(v){const e={touchStartX:0,touchStartY:0},c=v,u=q(),g=Q(),y=`이렇게 해서 ${S.extractText(c.material.title)}에 대해 알아봤습니다. 수고하셨습니다!`,d=b(()=>c.material.title.replace(/\*\*(.*?)\*\*/g,"<b>$1</b>")),m=b(()=>{const o=[c.material.desc];return n.value.length===0&&a.value.length===1&&o.push(a.value[0]),o.join("")}),n=b(()=>{const o=new DOMParser().parseFromString(c.document,"text/html");return Array.from(o.querySelectorAll(".slide-item")).map(l=>l.outerHTML)}),a=b(()=>{const o=[],l={},f=new DOMParser().parseFromString(c.document,"text/html");Array.from(f.querySelectorAll(".slide-text")).forEach(L=>{const R=L.getAttribute("data-slide-text-group");R&&(!l[R]&&(l[R]=[]),l[R].push(S.replaceAll(L.outerText,"  ","").trim()))});for(let L in l)o.push(l[L].join(`
`));return o}),p=b(()=>{var o;return window.Number.parseInt(((o=u.query.idx)==null?void 0:o.toString())||"0")}),s=b(()=>n.value.length+1),h=o=>{const l=S.renew(u.query);let f=p.value+o;f<0?f=0:f>s.value&&(f=s.value),p.value!==f&&(l.idx=f.toString(),g.push({query:l}))},w=o=>{switch(o.key){case"ArrowLeft":!o.altKey&&h(-1);break;case"ArrowRight":!o.altKey&&h(1);break;case"F9":case"Escape":g.push({query:void 0});break}},$=o=>{const l=o.touches[0];e.touchStartX=l.clientX,e.touchStartY=l.clientY},T=o=>{const l=o.changedTouches[0],f=l.clientX,z=l.clientY,L=f-e.touchStartX,R=z-e.touchStartY;Math.abs(L)>Math.abs(R)&&Math.abs(L)>50&&(L>0?h(-1):h(1))};return X(()=>{document.addEventListener("keyup",w),document.addEventListener("touchstart",$),document.addEventListener("touchend",T),document.body.classList.add(G)}),Y(()=>{document.removeEventListener("keyup",w),document.removeEventListener("touchstart",$),document.removeEventListener("touchend",T),document.body.classList.remove(G)}),(o,l)=>(r(),I(ae,{to:"body"},[t("div",Ae,[t("div",Ce,[p.value===0?(r(),i("div",Re,[t("div",Ie,[t("figure",De,[l[0]||(l[0]=t("img",{src:Le,alt:"코딩",loading:"lazy"},null,-1)),t("figcaption",null,[t("span",{innerHTML:d.value},null,8,qe),k(B,{content:m.value},null,8,["content"])])])])])):p.value===s.value?(r(),i("div",He,[t("div",Pe,[l[1]||(l[1]=t("figure",{class:"slide-item"},[t("img",{src:Ee,alt:"하이파이브",class:"mh-400",loading:"lazy"}),t("figcaption",null,[t("b",null,"이상 끝. "),t("span",null,"수고하셨습니다!")])],-1)),c.material.sources.length?(r(),I(ee,{key:0,class:"w-100 mb-3",sources:c.material.sources},null,8,["sources"])):x("",!0),c.material.references.length?(r(),I(te,{key:1,class:"w-100",references:c.material.references},null,8,["references"])):x("",!0),k(B,{content:y})])])):(r(!0),i(C,{key:2},O(n.value.length,f=>(r(),i(C,null,[p.value===f?(r(),i("div",Ne,[t("div",je,[k(se,{document:n.value[f-1]},null,8,["document"]),k(B,{content:a.value[f-1]||""},null,8,["content"])])])):x("",!0)],64))),256))])])]))}}),Be=E(Fe,[["__scopeId","data-v-56f6ed8a"]]);function Oe(){const v=P(null),e=P(null),c=P(!1);return{data:v,error:e,loading:c,request:async({url:g,method:y="GET",body:d,contentType:m="application/json",...n})=>{c.value=!0,e.value=null;try{const a={"Content-Type":m,...n.headers||{}},p={method:y,headers:a,...n};d&&(p.body=m==="application/json"?JSON.stringify(d):d);const s=await fetch(g,p);if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const h=s.headers.get("Content-Type");return h!=null&&h.includes("application/json")?v.value=await s.json():v.value=await s.text(),v.value}catch(a){throw e.value=a.message||"Unknown error",a}finally{c.value=!1}}}}const Ve={key:0,class:"presentation"},Xe={class:"content"},Ye={key:1,class:"empty"},Ue=M({__name:"MaterialCore",props:{material:{},onDocumentLoaded:{type:Function}},setup(v){const e=q(),c=oe(),u=H(),g=U(e),{data:y,loading:d,request:m}=Oe(),n=v,a=W({document:"<p>PLEASE WAIT A MOMENT</p>",accessible:!1}),p=()=>{if(!n.material.sources.length)return;const h=new DOMParser().parseFromString(a.document,"text/html");Array.from(h.querySelectorAll("[data-bs-toggle='popover']")).forEach(($,T)=>{if(!n.material.sources[T]){console.error("본문 속 팝오버의 개수와 출처 배열의 개수가 다릅니다.");return}$.setAttribute("title","자료 출처"),$.setAttribute("data-bs-content",S.linkify(n.material.sources[T])),$.innerText=`[${T+1}]`}),a.document=h.body.innerHTML},s=async()=>{const h=window.location.hostname==="localhost";if(a.accessible=n.material.locked?u.admin:!0,a.accessible){const w=g.getUrlPath(n.material);await m({url:`/assets${w}/document.html?${Date.now()}`,contentType:"text/html"});const $=le.get(N.unlockPasswordCookieName);if(n.material.locked&&$&&!h){const T=new de($,N.salt,N.iv);y.value=await T.decrypt(y.value).catch(o=>(console.error({err:o,message:"문서를 복호화 할 수 없습니다."}),null))}a.document=S.linkify(y.value),p()}ce(()=>{n.onDocumentLoaded()}),c.updateSiteTitle(S.extractText(n.material.title))};return ne(()=>{s()}),Y(()=>{c.updateSiteTitle()}),re(()=>e.path,()=>{s()}),(h,w)=>(r(),i("div",{class:V(["material-core",{skeleton:_(d)}])},[_(e).query.mode==="presentation"&&!_(d)&&a.accessible&&_(u).admin?(r(),i("div",Ve,[k(Be,{material:n.material,document:a.document},null,8,["material","document"])])):x("",!0),t("div",Xe,[a.accessible&&a.document?(r(),I(se,{key:0,document:a.document,skeleton:_(d)},null,8,["document","skeleton"])):(r(),i("div",Ye,"조회 가능한 문서가 없습니다."))])],2))}}),ze=E(Ue,[["__scopeId","data-v-9055fb2a"]]),Ke={class:"wrapper"},Ge={class:"title"},Je={class:"title"},Qe=M({__name:"MaterialNavigation",props:{material:{}},setup(v){const e=v,c=q(),u=H(),g=U(c),y=j(()=>{var a,p;const n=[];if((p=(a=e.material)==null?void 0:a.parent)!=null&&p.children){const s=ve.getTag(c);e.material.parent.children.forEach(h=>{(!s||h.tags.includes(s))&&n.push(h)})}return n}),d=j(()=>{var p;let n=null;const a=y.value;for(let s=0;s<a.length;s++)if(a[s].id===((p=e.material)==null?void 0:p.id)&&a[s-1]&&g.isVisible(a[s-1],u.admin)){n=a[s-1];break}return n}),m=j(()=>{var p;let n=null;const a=y.value;for(let s=0;s<a.length;s++)if(a[s].id===((p=e.material)==null?void 0:p.id)&&a[s+1]&&g.isVisible(a[s+1],u.admin)){n=a[s+1];break}return n});return(n,a)=>{const p=Z("router-link");return r(),i("div",{class:V(["material-navigation",{both:_(d)&&_(m)}])},[t("div",Ke,[_(d)?(r(),I(p,{key:0,to:_(d).url||"",class:"item prev",title:_(d).title},{default:D(()=>[a[0]||(a[0]=t("div",{class:"label"},[t("img",{src:me,alt:"이전"}),t("span",null,"이전")],-1)),t("div",Ge,A(_(S).extractText(_(d).title)),1)]),_:1},8,["to","title"])):x("",!0),_(m)?(r(),I(p,{key:1,to:_(m).url,class:"item next",title:_(m).title},{default:D(()=>[a[1]||(a[1]=t("div",{class:"label"},[t("img",{src:pe,alt:"다음"}),t("span",null,"다음")],-1)),t("div",Je,A(_(S).extractText(_(m).title)),1)]),_:1},8,["to","title"])):x("",!0)])],2)}}}),We=E(Qe,[["__scopeId","data-v-a593699b"]]),Ze={class:"material-above"},et={class:"back"},tt={class:"bottom"},st=["title"],at=["title"],J="?mode=presentation",ot=M({__name:"MaterialAbove",props:{material:{}},setup(v){const e=v,c=Q(),u=H(),g=d=>{d.key==="F9"&&u.admin&&c.push(J)},y=b(()=>{const d={title:"강의 자료",url:"/materials"};return e.material.parent&&(d.title=e.material.parent.title,d.url=e.material.parent.url),d});return X(()=>{document.addEventListener("keyup",g)}),Y(()=>{document.removeEventListener("keyup",g)}),(d,m)=>{const n=Z("router-link");return r(),i("div",Ze,[t("div",et,[k(n,{to:y.value.url},{default:D(()=>[m[0]||(m[0]=t("img",{src:_e,alt:"뒤로가기",title:"뒤로가기"},null,-1)),t("span",null,A(y.value.title),1)]),_:1},8,["to"])]),k(fe,{title:_(S).extractText(e.material.title),desc:e.material.desc},null,8,["title","desc"]),t("div",tt,[t("span",{title:e.material.created}," 생성: "+A(_(S).getHumanReadableDate(e.material.created)),9,st),e.material.created!==e.material.updated?(r(),i(C,{key:0},[m[1]||(m[1]=t("span",{class:"bar"},null,-1)),t("span",{title:e.material.updated}," 수정: "+A(_(S).getHumanReadableDate(e.material.updated)),9,at)],64)):x("",!0),e.material.presentation&&_(u).admin?(r(),i(C,{key:1},[m[3]||(m[3]=t("span",{class:"bar"},null,-1)),k(n,{to:J},{default:D(()=>m[2]||(m[2]=[ie("발표(F9)")])),_:1})],64)):x("",!0)])])}}}),nt=E(ot,[["__scopeId","data-v-ca04f4e1"]]),rt={class:"material"},lt={class:"container"},ct={key:0,class:"list"},it={class:"tags"},ut={key:1,class:"detail"},dt={class:"core",ref:"coreRef"},mt={key:0,class:"sources"},pt={key:1,class:"references"},_t={class:"navigation"},vt=M({__name:"MaterialDetail",setup(v){const e=q(),c=H(),u=U(e),g=F("aboveRef"),y=F("mainRef"),d=F("materialsRef"),m=W({contentLoaded:!1}),n=b(()=>{var o;return(o=e.params.id1)==null?void 0:o.toString()}),a=b(()=>{var o;return(o=e.params.id2)==null?void 0:o.toString()}),p=b(()=>{var o;return(o=e.params.id3)==null?void 0:o.toString()}),s=b(()=>u.get(n.value,a.value,p.value)),h=b(()=>{var o,l;return((l=(o=s.value)==null?void 0:o.parent)==null?void 0:l.children.filter(f=>u.isVisible(f,c.admin)))||[]}),w=b(()=>{var l;const o=new Set;return o.add(void 0),(l=u.get(n.value))==null||l.tags.forEach(f=>o.add(f)),o}),$=b(()=>{if(e.query.tag)return window.decodeURIComponent(e.query.tag.toString())}),T=()=>{m.contentLoaded=!0};return(o,l)=>{var f;return r(),i("div",rt,[t("div",lt,[s.value?(r(),i(C,{key:0},[t("div",{class:"above",ref_key:"aboveRef",ref:g},[k(nt,{material:s.value},null,8,["material"])],512),s.value.children.length?(r(),i("div",ct,[t("div",it,[k(ue,{tags:w.value,tag:$.value},null,8,["tags","tag"])]),k(K,{materials:s.value.children,tag:$.value},null,8,["materials","tag"])])):(r(),i("div",ut,[t("div",{class:"main",ref_key:"mainRef",ref:y},[t("div",dt,[k(ze,{material:s.value,onDocumentLoaded:T},null,8,["material"])],512),!s.value.locked&&s.value.sources.length?(r(),i("div",mt,[k(ee,{sources:s.value.sources},null,8,["sources"])])):x("",!0),!s.value.locked&&((f=s.value.references)!=null&&f.length)?(r(),i("div",pt,[k(te,{references:s.value.references},null,8,["references"])])):x("",!0),t("div",_t,[k(We,{material:s.value},null,8,["material"])])],512),m.contentLoaded&&h.value.length?(r(),i("div",{key:0,class:"materials",ref_key:"materialsRef",ref:d},[k(K,{materials:h.value},null,8,["materials"])],512)):x("",!0)]))],64)):x("",!0)])])}}}),Tt=E(vt,[["__scopeId","data-v-e0c0924e"]]);export{Tt as default};
